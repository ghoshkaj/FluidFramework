# This Yaml Document has been converted by ESAI Yaml Pipeline Conversion Tool.
# Please make sure to check all the converted content, it is your team's responsibility to make sure that the pipeline is still valid and functions as expected.
parameters:
- name: buildDirectory
  type: string
- name: testResultDirs
  type: object
  default:
  - nyc
steps:
- ${{ each testResultDir in parameters.testResultDirs }}:
  - task: PublishTestResults@2
    displayName: Publish Test Results in ${{ testResultDir }}
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/*junit-report.xml'
      searchFolder: ${{ parameters.buildDirectory }}/${{ testResultDir }}
      mergeTestResults: false
    condition: and(succeededOrFailed(), eq(variables['startTest'], 'true'))
- ${{ each testResultDir in parameters.testResultDirs }}:
  - task: Bash@3
    displayName: Log Failed Tests in ${{ testResultDir }}
    inputs:
      targetType: inline
      script: node $(Build.SourcesDirectory)/scripts/report-parser.js ${{ testResultDir }}
      workingDirectory: ${{ parameters.buildDirectory }}
    condition: and(succeededOrFailed(), eq(variables['startTest'], 'true'))